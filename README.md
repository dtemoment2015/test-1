# Тестовое задание Laravel API

Простое REST API для работы с новостями, видео-постами и комментариями. Итоговый результат всех API запросов можно посмотреть в файле `test.json` в корне проекта.

## Деплой через Laravel Sail

1. Клонируйте репозиторий:
```bash
git clone https://github.com/dtemoment2015/test-1.git
cd test-1
```

2. Установите зависимости:
```bash
composer install
```

3. Скопируйте файл окружения:
```bash
cp .env.example .env
```

4. Сгенерируйте ключ приложения:
```bash
php artisan key:generate
```

5. Запустите Docker контейнеры:
```bash
./vendor/bin/sail up -d
```

Если порт MySQL (3306) занят, можно изменить переменную `FORWARD_DB_PORT` в `.env` файле на другой порт, например `3307`.

6. Выполните миграции:
```bash
./vendor/bin/sail artisan migrate
```

7. Заполните базу тестовыми данными (сидер):
```bash
./vendor/bin/sail artisan db:seed
```

После этого API будет доступно по адресу `http://localhost/api/v1`

## Структура проекта

Проект разделен на слои.

**Routes (Маршруты)** - определяют URL и контроллеры. Роуты в `routes/api.php`.

**Controllers (Контроллеры)** - принимают запросы, вызывают сервисы. Логика в сервисах.

**Requests (Запросы)** - валидация входящих данных. Проверяют поля и форматы.

**DTOs (Data Transfer Objects)** - объекты передачи данных. Для создания и обновления.

**Resources (Ресурсы)** - форматируют данные в JSON. С курсорной пагинацией.

**Services (Сервисы)** - бизнес-логика приложения. Используют репозитории. При создании комментария берут случайного пользователя (`getTestUser()`).

**Repositories (Репозитории)** - работа с базой через модели. Интерфейсы и реализации.

**Models (Модели)** - Eloquent модели, структура таблиц.

## Структура базы данных

Четыре таблицы: users, news, video_posts, comments.

Комментарии через полиморфную связь. Поля `commentable_type` и `commentable_id`.

Комментарии поддерживают вложенность. Поле `comment_id` ссылается на родителя.

## Медиа библиотека

Spatie Media Library для видео. Видео в storage. В сидере используется https://ftp.dwish.uz/15/clip.webm.

## Особенности
- При создании комментария пользователь выбирается случайно. Метод `getTestUser()`.
- Все списки используют курсорную пагинацию. По умолчанию 5 записей.
- API возвращает JSON с полями `data` и `pagination`.



Задание:

Тестовое задание
Задача: Реализовать простую систему комментариев к контенту. Для проверки достаточно сделать API, шаблоны делать не нужно. 
Вводные:
Сущности – Новость, Видео Пост, Пользователь, Комментарий
На комментарии можно отвечать – это является отдельным комментарием, как и отвечать на комментарий к комментарию и т.д.
Необходимые API:
Создание/чтение видео постов, новостей. Поля – название, описание (к пользователю не привязываем, в рамках тестового это не играет роли)
CRUD комментариев от лица пользователя к видео посту/новости/комментарию

Основные требования:
При чтении Новости/Видео Поста API должно отдавать список комментариев с курсорной пагинацией
Технические требования:
PHP 8.2+, Laravel 11+, MySQL 8+. Для решения задачи можно использовать сторонние библиотеки если в них есть смысл, решение загрузить на GitHub.
